# Аутентификация и авторизация с использованием JWT

JWT (JSON Web Tokens) — это стандарт для создания токенов доступа, которые используются для аутентификации и авторизации пользователей в веб-приложениях. JWT позволяет безопасно передавать информацию между участниками в виде компактных JSON-объектов. В этом разделе мы рассмотрим основные концепции JWT, принципы работы, а также примеры использования в реальных проектах.

---

## 1. **Что такое JWT?**

JWT (JSON Web Token) — это стандарт для создания токенов, которые используются для передачи информации между участниками в виде JSON-объектов. Токены JWT состоят из трех частей:

1. **Заголовок (Header)**: Содержит метаданные, такие как тип токена и алгоритм шифрования.
2. **Полезная нагрузка (Payload)**: Содержит данные, которые передаются между участниками (например, идентификатор пользователя, роли и т.д.).
3. **Подпись (Signature)**: Используется для проверки подлинности токена.

### Пример структуры JWT:

```json
{
	"header": {
		"alg": "HS256",
		"typ": "JWT"
	},
	"payload": {
		"userId": 123,
		"role": "admin"
	},
	"signature": "HMACSHA256(base64UrlEncode(header) + '.' + base64UrlEncode(payload), secret)"
}
```

---

## 2. **Как работает JWT?**

### 2.1. **Создание токена**

1. **Заголовок**: Определяется тип токена и алгоритм шифрования.
2. **Полезная нагрузка**: Добавляются данные, которые необходимо передать (например, идентификатор пользователя).
3. **Подпись**: Создается подпись на основе заголовка, полезной нагрузки и секретного ключа.

**Пример создания токена:**

```javascript
const jwt = require("jsonwebtoken");
const secretKey = "your_secret_key";

const token = jwt.sign({ userId: 123, role: "admin" }, secretKey, {
	expiresIn: "1h",
});
console.log(token);
```

### 2.2. **Проверка токена**

1. **Получение токена**: Токен передается клиентом в заголовке запроса (например, `Authorization: Bearer <token>`).
2. **Проверка подписи**: Сервер проверяет подпись токена с помощью секретного ключа.
3. **Извлечение данных**: Если подпись верна, сервер извлекает данные из полезной нагрузки.

**Пример проверки токена:**

```javascript
const jwt = require("jsonwebtoken");
const secretKey = "your_secret_key";

const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."; // Полученный токен

jwt.verify(token, secretKey, (error, decoded) => {
	if (error) {
		console.error("Ошибка проверки токена:", error);
	} else {
		console.log("Данные токена:", decoded);
	}
});
```

---

## 3. **Преимущества JWT**

1. **Компактность**: JWT — это компактные JSON-объекты, которые легко передавать по сети.
2. **Безопасность**: Подпись токена гарантирует его подлинность и целостность.
3. **Гибкость**: JWT можно использовать для передачи любых данных, что делает их универсальными.
4. **Совместимость**: JWT поддерживается большинством языков программирования и фреймворков.

---

## 4. **Недостатки JWT**

1. **Безопасность секретного ключа**: Если секретный ключ будет скомпрометирован, злоумышленник сможет создавать поддельные токены.
2. **Отсутствие механизма отзыва**: JWT не предоставляет встроенного механизма для отзыва токенов.
3. **Размер токена**: Хотя JWT компактны, они могут стать большими, если в полезную нагрузку добавляется много данных.

---

## 5. **Пример использования JWT в реальном проекте**

### 5.1. **Аутентификация пользователя**

1. **Регистрация/вход**: Пользователь вводит имя пользователя и пароль.
2. **Создание токена**: Сервер проверяет учетные данные и создает JWT с идентификатором пользователя и ролью.
3. **Передача токена**: Токен передается клиенту и сохраняется в `localStorage` или `httpOnly` куки.
4. **Проверка токена**: При каждом запросе клиент передает токен в заголовке `Authorization`. Сервер проверяет токен и извлекает данные пользователя.

**Пример кода для аутентификации:**

```javascript
const express = require("express");
const jwt = require("jsonwebtoken");
const app = express();

const secretKey = "your_secret_key";

// Создание токена при входе
app.post("/login", (req, res) => {
	const { username, password } = req.body;

	// Проверка учетных данных (здесь используется заглушка)
	if (username === "admin" && password === "password") {
		const token = jwt.sign({ userId: 123, role: "admin" }, secretKey, {
			expiresIn: "1h",
		});
		res.json({ token });
	} else {
		res.status(401).send("Неверные учетные данные");
	}
});

// Проверка токена при запросе
app.get("/dashboard", (req, res) => {
	const token = req.headers["authorization"];

	if (!token) {
		return res.status(401).send("Токен отсутствует");
	}

	jwt.verify(token, secretKey, (error, decoded) => {
		if (error) {
			return res.status(401).send("Неверный токен");
		}
		res.json({ message: "Доступ разрешен", user: decoded });
	});
});

app.listen(3000, () => {
	console.log("Сервер запущен на порту 3000");
});
```

---

## 6. **Заключение**

JWT — это мощный инструмент для аутентификации и авторизации в веб-приложениях. Он обеспечивает безопасность, компактность и гибкость, но требует правильной настройки и защиты секретного ключа. JWT широко используется в современных приложениях благодаря своей универсальности и совместимости с различными языками программирования.
